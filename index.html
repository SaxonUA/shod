<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>WoT Ultimate HUD ¬∑ Strict Logic & Original Style</title>
  <style>
    :root {
      --accent: #00f2ff;
      --save-color: #ffaa00;
      --success-color: #00ff95;
      --fail-color: #ff3c3c;
      --card-bg: #121519;
      --view-width: 600px;
      --card-width: 200px;
      --card-gap: -40px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: transparent;
      font-family: 'Arial', 'Helvetica', sans-serif;
      color: #fff;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .stats-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 10px;
      z-index: 100;
    }
    .stat-box {
      background: rgba(18, 21, 25, 0.95);
      border: 1px solid rgba(255,255,255,0.1);
      border-top: 3px solid var(--accent);
      padding: 10px 25px;
      border-radius: 10px;
      text-align: center;
      min-width: 130px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.7);
    }
    .stat-box.orange-style { border-top: 3px solid var(--save-color); }
    .stat-box.orange-style .stat-value { color: var(--save-color); }
    .stat-label { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 5px; }
    .stat-value { font-family: 'Arial Black', sans-serif; font-size: 28px; font-weight: 900; color: var(--accent); }

    .viewport {
      width: var(--view-width);
      height: 400px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      mask-image: linear-gradient(to right, transparent 0%, black 20%, black 80%, transparent 100%);
    }

    .card-row {
      display: flex;
      align-items: center;
      position: absolute;
      left: 0;
      transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      padding-left: calc(var(--view-width) / 2 - var(--card-width) / 2);
    }

    .card {
      width: var(--card-width);
      height: 280px;
      background: var(--card-bg);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 18px;
      margin-right: var(--card-gap);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 15px;
      flex-shrink: 0;
      transition: all 0.6s ease;
      opacity: 0.2;
      transform: scale(0.85);
      filter: grayscale(1);
      position: relative;
      overflow: hidden;
    }

    .card.active { opacity: 1; transform: scale(1.1); border: 2px solid var(--accent); box-shadow: 0 0 50px rgba(0, 242, 255, 0.5); z-index: 50; filter: grayscale(0); }
    .card.is-save.active { border-color: var(--save-color); box-shadow: 0 0 50px rgba(255, 170, 0, 0.5); }
    .card.prev, .card.next { opacity: 0.5; transform: scale(0.95); filter: grayscale(0.5); z-index: 10; }

    /* –ü–µ—á–∞—Ç–∫–∞ –í–ò–ö–û–ù–ê–ù–û */
    .stamp {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) rotate(-25deg) scale(3);
      border: 6px double var(--fail-color);
      color: var(--fail-color);
      padding: 5px 15px;
      font-family: 'Arial Black', sans-serif;
      font-size: 24px;
      text-transform: uppercase;
      opacity: 0;
      background: rgba(0,0,0,0.4);
      transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 100;
      pointer-events: none;
    }
    .card.completed .stamp { opacity: 0.9; transform: translate(-50%, -50%) rotate(-25deg) scale(1); }

    .card-header { width: 100%; display: flex; justify-content: space-between; align-items: center; height: 25px; margin-bottom: 10px; }
    .save-label { font-size: 10px; font-weight: 900; color: var(--save-color); text-transform: uppercase; }
    .status-icon { font-size: 20px; }
    .card-main { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    .step-text { font-family: 'Arial Black', sans-serif; font-size: 14px; font-weight: 900; color: var(--accent); margin-bottom: 4px; text-transform: uppercase; }
    .is-save .step-text { color: var(--save-color); }
    .dmg-value { font-family: 'Arial Black', sans-serif; font-size: 52px; font-weight: 900; color: #fff; line-height: 1; }
    .card-footer { width: 100%; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
    .tier-label { font-size: 11px; color: #777; font-weight: 600; margin-bottom: 2px; }
    .tier-value { font-family: 'Arial Black', sans-serif; font-size: 24px; font-weight: 700; color: #fff; }
    
    @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.3); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }
    .active .status-icon { animation: pulse 1.5s infinite; }
  </style>
</head>
<body>

<div class="stats-bar">
  <div class="stat-box orange-style"><div class="stat-label">–í—Å—å–æ–≥–æ –±–æ—ó–≤</div><div id="totalBattles" class="stat-value">0</div></div>
  <div class="stat-box"><div class="stat-label">–í—ñ–Ω—Ä–µ–π—Ç</div><div id="winRate" class="stat-value">0%</div></div>
</div>

<div class="viewport"><div class="card-row" id="cardRow"></div></div>

<script>
  (function() {
    const SHEET_ID = "17phnEn-NW-OnrZg4DcW65r-Xoq6ScsdVjS5yL0SS3fk";
    const STEPS = [
      {s:1, t:4, dmg:1000, save:false}, {s:2, t:5, dmg:1500, save:false},
      {s:3, t:6, dmg:2000, save:false}, {s:4, t:7, dmg:2500, save:false},
      {s:5, t:8, dmg:3000, save:true }, {s:6, t:9, dmg:3500, save:false},
      {s:7, t:10, dmg:4500, save:false}, {s:8, t:10, dmg:5000, save:true },
      {s:9, t:11, dmg:5500, save:false}, {s:10, t:11, dmg:6000, save:false}
    ];

    let currentIdx = -1;
    let isInitialized = false;

    function initCards() {
      const row = document.getElementById('cardRow');
      row.innerHTML = '';
      STEPS.forEach((step, i) => {
        const card = document.createElement('div');
        card.className = `card ${step.save ? 'is-save' : ''}`;
        card.id = `card-${i}`;
        card.innerHTML = `
          <div class="stamp">–í–∏–∫–æ–Ω–∞–Ω–æ</div>
          <div class="card-header">
            <div class="save-label">${step.save ? '–ë–µ–∑–ø–µ—á–Ω–∞ –º–µ–∂–∞' : ''}</div>
            <div class="status-icon" id="icon-${i}">${step.save ? 'üõ°Ô∏è' : ''}</div>
          </div>
          <div class="card-main">
            <div class="step-text">–°—Ö–æ–¥–∏–Ω–∫–∞ ${step.s}</div>
            <div class="dmg-value">${step.dmg}</div>
          </div>
          <div class="card-footer">
            <div class="tier-label">–†—ñ–≤–µ–Ω—å —Ç–∞–Ω–∫—É:</div>
            <div class="tier-value">${step.t}</div>
          </div>
        `;
        row.appendChild(card);
      });
      isInitialized = true;
    }

    function updateCarousel(idx, isFinished) {
      const row = document.getElementById('cardRow');
      const cards = document.querySelectorAll('.card');
      cards.forEach((card, i) => {
        card.classList.remove('active', 'prev', 'next', 'completed');
        const icon = document.getElementById(`icon-${i}`);
        if (i === idx) {
          card.classList.add('active');
          if (isFinished && i === 9) card.classList.add('completed');
          icon.innerHTML = (isFinished && i === 9) ? 'üëë' : 'üéØ';
        } else if (i === idx - 1) {
          card.classList.add('prev');
          icon.innerHTML = '‚úîÔ∏è';
        } else if (i === idx + 1) {
          card.classList.add('next');
          icon.innerHTML = STEPS[i].save ? 'üõ°Ô∏è' : '';
        } else {
          icon.innerHTML = i < idx ? '‚úîÔ∏è' : (STEPS[i].save ? 'üõ°Ô∏è' : '');
        }
      });
      const cardMoveWidth = 160; 
      row.style.transform = `translateX(-${idx * cardMoveWidth}px)`;
      currentIdx = idx;
    }

    async function fetchData() {
      try {
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
        const res = await fetch(url);
        const text = await res.text();
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const data = json.table.rows.map(r => ({
          battleNo: r.c[0]?.v || 0,
          tier: r.c[3]?.v || 0,
          dmg: r.c[4]?.v || 0,
          isWin: r.c[7]?.v || 0
        })).filter(r => r.battleNo > 0).sort((a,b) => a.battleNo - b.battleNo);

        let tempIdx = 0, lastSaveIdx = 0, wins = 0, isFinished = false;
        data.forEach(r => {
          if (r.isWin === 1) wins++;
          let target = STEPS[tempIdx];
          if (r.tier === target.t) { // –°–£–í–û–†–ò–ô –†–Ü–í–ï–ù–¨
            if (r.dmg >= target.dmg) {
              if (tempIdx === 9) isFinished = true;
              else {
                tempIdx++;
                if (STEPS[tempIdx].save) lastSaveIdx = tempIdx;
              }
            } else { // –í–Ü–î–ö–ê–¢ –ù–ê –û–î–ù–£ –°–•–û–î–ò–ù–ö–£ (–ê–õ–ï –ù–ï –ù–ò–ñ–ß–ï –°–ï–ô–í–£)
              tempIdx = Math.max(tempIdx - 1, lastSaveIdx);
            }
          }
        });

        document.getElementById('totalBattles').textContent = data.length;
        const wr = data.length > 0 ? Math.round((wins / data.length) * 100) : 0;
        const wrEl = document.getElementById('winRate');
        wrEl.textContent = wr + '%';
        wrEl.style.color = wr >= 50 ? 'var(--success-color)' : 'var(--fail-color)';

        if (!isInitialized) initCards();
        updateCarousel(tempIdx, isFinished);
      } catch (e) { console.error(e); }
    }

    fetchData();
    setInterval(fetchData, 4000);
  })();
</script>
</body>
</html>
